<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Synchronization # Precedence # Let $a_1$ (resp. $a_2$) be an instruction executed in a thread $t_1$ (resp. $t_2$). By default, if $t_1$ and $t_2$ are executed concurrently, there is no guarantee that $a_1$ is executed before $a_2$. However, most programming languages provide mechanisms to enforce it.
in Java # The Javadoc of the package java.util.concurrent summarizes the situations where a statement must be executed before another. In Java&rsquo;s terminology, this binary relation over statements is called the &ldquo;happens before&rdquo; relation.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://unibz-pp-23-24.github.io/docs/multithreading/sections/synchronization/">
  <meta property="og:site_name" content="Programming project 2023-24">
  <meta property="og:title" content="Synchronization">
  <meta property="og:description" content="Synchronization # Precedence # Let $a_1$ (resp. $a_2$) be an instruction executed in a thread $t_1$ (resp. $t_2$). By default, if $t_1$ and $t_2$ are executed concurrently, there is no guarantee that $a_1$ is executed before $a_2$. However, most programming languages provide mechanisms to enforce it.
in Java # The Javadoc of the package java.util.concurrent summarizes the situations where a statement must be executed before another. In Java’s terminology, this binary relation over statements is called the “happens before” relation.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Synchronization | Programming project 2023-24</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="stylesheet" href="/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.867b3dcab60edd90a7c857f7cfb6444400a1bc5010c5e91ffc524a9bb2956527.js" integrity="sha256-hns9yrYO3ZCnyFf3z7ZERAChvFAQxekf/FJKm7KVZSc=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
  integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"
  crossorigin="anonymous"
/>


<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
  integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
  crossorigin="anonymous"
></script>


<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
  integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
  crossorigin="anonymous"
  onload="renderMathInElement(document.body);"
></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ],
    });
  });
</script>

</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Programming project 2023-24</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f1c1e874f9c9473478447bba6c7db644" class="toggle"  />
    <label for="section-f1c1e874f9c9473478447bba6c7db644" class="flex justify-between">
      <a href="/docs/intro/" class="">This course</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/schedule/" class="">Schedule</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/lecturers/" class="">Teaching staff</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/evaluation/" class="">Evaluation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/content/" class="">Content</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/board_game/" class="">Board game</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/bibliography/" class="">Bibliography</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bc4d9392f5af16481cccf0c311076888" class="toggle"  />
    <label for="section-bc4d9392f5af16481cccf0c311076888" class="flex justify-between">
      <a href="/docs/project/" class="">Project</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/project/sections/free_project/" class="">Option 1: free project</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/project/sections/board_game/" class="">Option 2: board game</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3435ead23eba75b5ffeeb8d422f70dea" class="toggle"  />
    <label for="section-3435ead23eba75b5ffeeb8d422f70dea" class="flex justify-between">
      <a href="/docs/objects/" class="">Objects and classes</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/objects/" class="">Objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/classes/" class="">Class and instance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/inheritance/" class="">Inheritance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/methods/" class="">Instance methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/tostring/" class="">Displaying objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/comparing/" class="">Cast and equality</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/classesasobjects/" class="">Classes as objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/clone/" class="">Duplicating objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/quasi-objects/" class="">Quasi-objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/encapsulation/" class="">Encapsulation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/mutability/" class="">Mutability</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/quiz/" class="">Quiz</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-48bc13e86f573c257821b397e779b02e" class="toggle"  />
    <label for="section-48bc13e86f573c257821b397e779b02e" class="flex justify-between">
      <a href="/docs/interfaces/" class="">Interfaces</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/interfaces/sections/specification/" class="">Specification and programming interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interfaces/sections/java_interfaces/" class="">Java interfaces</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e06acd393c0cc6e5b27e2cd8945d3dd8" class="toggle"  />
    <label for="section-e06acd393c0cc6e5b27e2cd8945d3dd8" class="flex justify-between">
      <a href="/docs/abstractdatatypes/" class="">Abstract data types</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/list/" class="">List</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/set/" class="">Set</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/map/" class="">Associative array</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/queue/" class="">Stack, queue, priority queue</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/sorting/" class="">Sorting</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5d60f9e6a9b7c875f51358c583373282" class="toggle"  />
    <label for="section-5d60f9e6a9b7c875f51358c583373282" class="flex justify-between">
      <a href="/docs/datastructures/" class="">Data structures</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/datastructures/sections/list/" class="">Dynamic array and linked list</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/datastructures/sections/hash/" class="">Hash table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/datastructures/sections/tree/" class="">Binary search tree</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-93b39c27c032f5f72bed81496cbb41e3" class="toggle"  />
    <label for="section-93b39c27c032f5f72bed81496cbb41e3" class="flex justify-between">
      <a href="/docs/errors/" class="">Errors</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a2fa4d1523374519c87fe83f9d8226b6" class="toggle"  />
    <label for="section-a2fa4d1523374519c87fe83f9d8226b6" class="flex justify-between">
      <a href="/docs/errors/sections/callstack/" class="">Call stack</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-323953d2054911560fd76ed4505d5bb2" class="toggle"  />
    <label for="section-323953d2054911560fd76ed4505d5bb2" class="flex justify-between">
      <a href="/docs/errors/sections/exceptions/" class="">Exceptions</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-03b7629c50286af7810d9917f4bdabd2" class="toggle"  />
    <label for="section-03b7629c50286af7810d9917f4bdabd2" class="flex justify-between">
      <a href="/docs/errors/sections/checked/" class="">Checked vs unchecked</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3add83584009ceb58c28b43e0a2280c9" class="toggle"  />
    <label for="section-3add83584009ceb58c28b43e0a2280c9" class="flex justify-between">
      <a href="/docs/errors/sections/custom/" class="">Custom exceptions</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b9c696d05ab8cb944ddf9cef47a3abb4" class="toggle"  />
    <label for="section-b9c696d05ab8cb944ddf9cef47a3abb4" class="flex justify-between">
      <a href="/docs/errors/sections/errors/" class="">Java errors</a>
    </label>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1be866adbf7f2244d1773e0d2a159b91" class="toggle"  />
    <label for="section-1be866adbf7f2244d1773e0d2a159b91" class="flex justify-between">
      <a href="/docs/recursion/" class="">Recursion</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/recursion/sections/linear/" class="">Linear recursion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/recursion/sections/nary/" class="">N-ary recursion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/recursion/sections/correctness/" class="">Correctness</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b7bc445f96cbe2bd1034c5f1c5d075bb" class="toggle"  />
    <label for="section-b7bc445f96cbe2bd1034c5f1c5d075bb" class="flex justify-between">
      <a href="/docs/input/" class="">I/O and serialization</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-09ea3b18445537bd77c25d3db6ab2fcf" class="toggle"  />
    <label for="section-09ea3b18445537bd77c25d3db6ab2fcf" class="flex justify-between">
      <a href="/docs/input/sections/files/" class="">Paths and files in Java</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-640b25aadb55f28505bfbbe5a5f7073d" class="toggle"  />
    <label for="section-640b25aadb55f28505bfbbe5a5f7073d" class="flex justify-between">
      <a href="/docs/input/sections/read/" class="">Reading from and writing to a file in Java</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7efe7741b54b5b602db75415a7806ef4" class="toggle"  />
    <label for="section-7efe7741b54b5b602db75415a7806ef4" class="flex justify-between">
      <a href="/docs/input/sections/property/" class="">Configuration files</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-37fdfe811c449d15e51a84c19673df2f" class="toggle"  />
    <label for="section-37fdfe811c449d15e51a84c19673df2f" class="flex justify-between">
      <a href="/docs/input/sections/serialize/" class="">Serialization</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ec41b3fcd24b301058a1bd1bd7b5c8e7" class="toggle"  />
    <label for="section-ec41b3fcd24b301058a1bd1bd7b5c8e7" class="flex justify-between">
      <a href="/docs/input/sections/json/" class="">JSON Serialization</a>
    </label>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-baf3ea6e28839ac044570d2d313c8794" class="toggle"  />
    <label for="section-baf3ea6e28839ac044570d2d313c8794" class="flex justify-between">
      <a href="/docs/regex/" class="">Regular expressions</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/regex/sections/pattern/" class="">Pattern matching</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/regex/sections/practice/" class="">in practice</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/regex/sections/java/" class="">Using Java regexes</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ae8fba9e927e4c55801a4e71f6b7d054" class="toggle"  />
    <label for="section-ae8fba9e927e4c55801a4e71f6b7d054" class="flex justify-between">
      <a href="/docs/lambda/" class="">Callback methods and lambda expressions</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/pure/" class="">Pure function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/anonymous/" class="">Anonymous method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/lambda/" class="">Lambda expression</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/type/" class="">Type of a method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/callback/" class="">Callback method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/captured/" class="">Captured variables</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-41a2765a9682fb1ce579fb1661f1250d" class="toggle"  />
    <label for="section-41a2765a9682fb1ce579fb1661f1250d" class="flex justify-between">
      <a href="/docs/stream/" class="">Streams in Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/pipeline/" class="">Pipeline</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/init/" class="">Source</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/intermediate/" class="">Intermediate operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/terminal/" class="">Terminal operation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/numeric/" class="">Numeric stream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/order/" class="">Multithreading and order</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/optional/" class="">Optional</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-87d53bbeb97db8aab24c02b4d45460f2" class="toggle"  />
    <label for="section-87d53bbeb97db8aab24c02b4d45460f2" class="flex justify-between">
      <a href="/docs/generics/" class="">Generic programming</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/type_checking/" class="">Type checking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/generics/" class="">Generics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/subtype/" class="">Subtype</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/variance/" class="">Variance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/erasure/" class="">Type erasure</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5dcccd15580bb824ba055538c97bdea6" class="toggle" checked />
    <label for="section-5dcccd15580bb824ba055538c97bdea6" class="flex justify-between">
      <a href="/docs/multithreading/" class="">Multithreading</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/concurrency/" class="">Concurrency</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/thread/" class="">Process vs thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/simple/" class="">A simplified view</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/race/" class="">Race condition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/synchronization/" class="active">Synchronization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/troubleshooting/" class="">Troubleshooting</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/abstractions/" class="">Abstractions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9d77b970a03dc72b048d9fce7bfe272f" class="toggle"  />
    <label for="section-9d77b970a03dc72b048d9fce7bfe272f" class="flex justify-between">
      <a href="/docs/unittests/" class="">Unit tests</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-796939dc839b82c2ff89d99e47011262" class="toggle"  />
    <label for="section-796939dc839b82c2ff89d99e47011262" class="flex justify-between">
      <a href="/docs/unittests/sections/structured/" class="">Code units</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ad5c3d825858d4a9ca4ad02d541f7121" class="toggle"  />
    <label for="section-ad5c3d825858d4a9ca4ad02d541f7121" class="flex justify-between">
      <a href="/docs/unittests/sections/tdd/" class="">Development driven by unit tests</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7e09be54c45521908b57f9eaf194f5f6" class="toggle"  />
    <label for="section-7e09be54c45521908b57f9eaf194f5f6" class="flex justify-between">
      <a href="/docs/unittests/sections/junit/" class="">in Java</a>
    </label>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-494fdb80ca3ad5d2868cb487a042ae27" class="toggle"  />
    <label for="section-494fdb80ca3ad5d2868cb487a042ae27" class="flex justify-between">
      <a href="/docs/env/" class="">Development environment</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/files/" class="">Hierarchical file system</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/backup/" class="">Backup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/install/" class="">Software management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/os/" class="">Operating system</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/requirements/" class="">Requirements for this course</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/ide/" class="">IDE</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/text_editor/" class="">Text editor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/eval/" class="">Evaluation environment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/terminal/" class="">Terminal</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2870a15a3d2cff84408f43cbb1e77f97" class="toggle"  />
    <label for="section-2870a15a3d2cff84408f43cbb1e77f97" class="flex justify-between">
      <a href="/docs/git/" class="">git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/basics/" class="">Basics: repository, commits and branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/collaboration/" class="">Basics: network and collaboration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/config/" class="">Configuration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/create/" class="">Create or clone a repository</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/commit/" class="">Add, commit, stash</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/branches/" class="">Branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/sharing/" class="">Synchronization: remote, push, pull</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/backtracking/" class="">Backtracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/ignore/" class="">Ignoring files</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/resources/" class="">To go further</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-44fa5eb3511a340ff4e9042080604b5c" class="toggle"  />
    <label for="section-44fa5eb3511a340ff4e9042080604b5c" class="flex justify-between">
      <a href="/docs/build/" class="">Build automation</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0c816e62fd66eb322757addb01600cdd" class="toggle"  />
    <label for="section-0c816e62fd66eb322757addb01600cdd" class="flex justify-between">
      <a href="/docs/build/sections/packaging/" class="">Packaging a Java application</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5537e478f301d8ff4f0b5a7a03c9db32" class="toggle"  />
    <label for="section-5537e478f301d8ff4f0b5a7a03c9db32" class="flex justify-between">
      <a href="/docs/build/sections/layout/" class="">Layout</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-33bd3456c4645cc966d192fba400a71a" class="toggle"  />
    <label for="section-33bd3456c4645cc966d192fba400a71a" class="flex justify-between">
      <a href="/docs/build/sections/pom/" class="">Configuration file</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c956d0b428ebb6c853f314459a513393" class="toggle"  />
    <label for="section-c956d0b428ebb6c853f314459a513393" class="flex justify-between">
      <a href="/docs/build/sections/artifact/" class="">Artifact</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d01a14431bc2161a8fed02d90e1a365b" class="toggle"  />
    <label for="section-d01a14431bc2161a8fed02d90e1a365b" class="flex justify-between">
      <a href="/docs/build/sections/dependencies/" class="">Dependencies</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b838446830102a7dece872d673537390" class="toggle"  />
    <label for="section-b838446830102a7dece872d673537390" class="flex justify-between">
      <a href="/docs/build/sections/building/" class="">Building</a>
    </label>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ffcf8551871937aae0ce60f2b3cc616b" class="toggle"  />
    <label for="section-ffcf8551871937aae0ce60f2b3cc616b" class="flex justify-between">
      <a href="/docs/background/" class="">Background</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/problem/" class="">Computational problem</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/set_tuple_map/" class="">Set, tuple, function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/order/" class="">Relation, preorder</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/cost/" class="">Computational cost</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/regular/" class="">Regular languages</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Synchronization</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#precedence">Precedence</a>
      <ul>
        <li><a href="#in-java">in Java</a></li>
      </ul>
    </li>
    <li><a href="#mutual-exclusion">Mutual exclusion</a>
      <ul>
        <li><a href="#in-java-1">in Java</a></li>
      </ul>
    </li>
    <li><a href="#condition-variables">Condition variables</a>
      <ul>
        <li><a href="#the-producerconsumer-pattern">The producer/consumer pattern</a></li>
        <li><a href="#in-java-2">in Java</a></li>
        <li><a href="#spurious-wakeup">Spurious wakeup</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="synchronization">
  Synchronization
  <a class="anchor" href="#synchronization">#</a>
</h1>
<h2 id="precedence">
  Precedence
  <a class="anchor" href="#precedence">#</a>
</h2>
<p>Let $a_1$ (resp. $a_2$) be an instruction executed in a thread $t_1$ (resp. $t_2$).
By default, if $t_1$ and $t_2$ are executed concurrently, there is no guarantee that $a_1$ is executed before $a_2$.
However, most programming languages provide mechanisms to enforce it.</p>
<h3 id="in-java">
  in Java
  <a class="anchor" href="#in-java">#</a>
</h3>
<p>The Javadoc of the package <a href="">java.util.concurrent</a> summarizes the situations where a statement <em>must</em> be executed before another.
In Java&rsquo;s terminology, this binary relation over statements is called the &ldquo;happens before&rdquo; relation.</p>
<h2 id="mutual-exclusion">
  Mutual exclusion
  <a class="anchor" href="#mutual-exclusion">#</a>
</h2>
<blockquote class="book-hint warning">
  <strong>Mutual exclusion</strong>,
prevents two threads to access a same resource concurrently.
This is generally achieved via some kind of <strong>lock</strong> (sometimes called a <strong>mutex</strong> or <strong>semaphore</strong>).
</blockquote>

<p>Most programming languages that support concurrency provide a mechanism for mutual exclusion.
These include C/C++, C#, Go, Java, PHP, Python, or Rust.</p>
<h3 id="in-java-1">
  in Java
  <a class="anchor" href="#in-java-1">#</a>
</h3>
<p><blockquote class="book-hint warning">
  Java associates to each object a so-called <strong>intrinsic lock</strong> (also called <strong>monitor lock</strong> or simply <strong>monitor</strong>).
</blockquote>

If a thread $t_1$ acquires the lock of an object $o$, then a different thread $t_2$ cannot acquire this lock until $t_1$ has released it (however, a thread can reacquire a lock that it already owns).</p>
<p>The keyword <code>synchronized</code> relies on the intrinsic lock to enforce mutual exclusion.
In can be used in two ways:</p>
<h4 id="synchronized-method">
  Synchronized method
  <a class="anchor" href="#synchronized-method">#</a>
</h4>
<p>A java method can be declared with the <code>synchronized</code> keyword, as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">myMethod</span>() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>For an instance method $m$, this has two consequences.
Let $o$ be an object, let $t_1$ and $t_2$ be two (different) threads, and let us assume that $t_1$ executes $o.m$ (i.e. $t_1$ executes the method $m$ for the object $o$).
Then:</p>
<ul>
<li>$t_2$ cannot execute <em>any</em> synchronized method for $o$ before the termination of $o.m$,</li>
<li>after completion of $o.m$, if this method modified $o$, then these modifications will be visible to any <em>synchronized</em> method executed for $o$ by $t_2$.</li>
</ul>
<blockquote class="book-hint info">
  <strong><em>Note.</em></strong>
For the same object, a synchronized method can call another, as long as they are executed by the same thread.
</blockquote>





<div class="book-tabs"><input type="radio" class="toggle" name="tabs-exercise_synchronized" id="tabs-exercise_synchronized-0" checked="checked" />
  <label for="tabs-exercise_synchronized-0">Exercise</label>
  <div class="book-tabs-content markdown-inner"><p>What are the possible outputs of the following program?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Counter</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Counter</span>(<span style="color:#66d9ef">int</span> value){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">inc</span>(<span style="color:#66d9ef">int</span> delta){
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> delta;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doubleDec</span>(<span style="color:#66d9ef">int</span> delta){
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">-=</span> delta;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">-=</span> delta;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getValue</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Counter counter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Counter(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { counter.<span style="color:#a6e22e">inc</span>(5); } );
</span></span><span style="display:flex;"><span>t1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { counter.<span style="color:#a6e22e">doubleDec</span>(2); } );
</span></span><span style="display:flex;"><span>t2.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(counter.<span style="color:#a6e22e">getValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    t1.<span style="color:#a6e22e">join</span>();
</span></span><span style="display:flex;"><span>    t2.<span style="color:#a6e22e">join</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(counter.<span style="color:#a6e22e">getValue</span>());
</span></span></code></pre></div></div><input type="radio" class="toggle" name="tabs-exercise_synchronized" id="tabs-exercise_synchronized-1"  />
  <label for="tabs-exercise_synchronized-1">Solution</label>
  <div class="book-tabs-content markdown-inner"><p>Because the two methods <code>inc</code> and <code>doubleDec</code> are synchronized (and are called on the same object), their executions cannot interleave.
This guarantees that the <em>second</em> print statement must output <code>1</code>.</p>
<p>As for the first print statement, observe that:</p>
<ul>
<li>there is no guarantee on the order of execution of <code>counter.inc(5)</code>, <code>counter.doubleDec(2)</code> and the first call to <code>counter.getvalue()</code>.</li>
<li>the method <code>getValue()</code> is not synchronized, so the first call to <code>counter.getvalue()</code> this method may be executed during the execution of <code>counter.inc(5)</code> or <code>counter.doubleDec(2)</code>.</li>
</ul>
<p>So the possible output values here are
<code>0</code>,
<code>5</code>,
<code>3</code>,
<code>1</code>,
<code>-2</code> and
<code>-4</code>.</p>
</div></div>

<p>For a <em>static</em> method, the effect of the <code>synchronized</code> keyword is identical, but the object $o$ is the instance of <code>Class</code> that represents the class itself.</p>
<blockquote class="book-hint danger">
  <strong><em>Warning.</em></strong>
A constructor <em>cannot</em> be synchronized (the program will not compile).
</blockquote>

<h4 id="synchronized-statement">
  Synchronized statement
  <a class="anchor" href="#synchronized-statement">#</a>
</h4>
<p>As an alternative (or complement) to synchronized methods, a <strong>synchronized statement</strong> allows using an intrinsic lock that may or may not be the one of the current object.</p>
<p>The syntax is the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span>(object){
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>code block<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Upon entering the code block, a thread acquires the intrinsic lock of the object <code>object</code>, and releases it when exiting the code block.</p>
<p>Synchronized statements are more expressive than synchronized methods.
In particular, the two following syntaxes are equivalent:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">myMethod</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>method body<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>$\qquad$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">myMethod</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span>(<span style="color:#66d9ef">this</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>method body<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Synchronized statements offer a more fine-grained control than synchronized statements.</p>
<blockquote class="book-hint info">
  <p><strong><em>Example.</em></strong>
The following example is adapted from the <a href="https://docs.oracle.com/javase%2Ftutorial%2F/essential/concurrency/syncrgb.html">Oracle tutorial</a>.</p>
<p>Consider the following class <code>City</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">City</span> {
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> zipCode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">City</span>(String name, <span style="color:#66d9ef">int</span> zipCode){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">zipCode</span> <span style="color:#f92672">=</span> zipCode;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now let us assume that a thread creates an instance of this class, and later on retrieves its name and zip code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>City city <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> City(<span style="color:#e6db74">&#34;Bologna&#34;</span>, 40100);
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Instruction 1</span>
</span></span><span style="display:flex;"><span>String myCityName <span style="color:#f92672">=</span> city.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Instruction 2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> myCityCode <span style="color:#f92672">=</span> city.<span style="color:#a6e22e">zipCode</span>;
</span></span></code></pre></div><p>If another thread modifies the object <code>city</code> between the execution of Instruction 1 and Instruction 2, then
<code>myCityName</code> may contain the name of a city, and <code>myCityCode</code> the zip code of another.</p>
<p>To prevent this, we can a synchronized statement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> (city) {
</span></span><span style="display:flex;"><span>    String myCityName <span style="color:#f92672">=</span> city.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> myCityCode <span style="color:#f92672">=</span> city.<span style="color:#a6e22e">zipCode</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</blockquote>

<h2 id="condition-variables">
  Condition variables
  <a class="anchor" href="#condition-variables">#</a>
</h2>
<p>We saw earlier that a thread $t_1$ can wait for another thread $t_2$ to terminate (e.g. with the pseudocode keyword <code>sync</code>, or with the Java instance method <code>Thread.join</code>).</p>
<p>In this case, when it terminates, $t_2$ <strong>wakes up</strong> $t_1$, which can resume its execution.</p>
<p>A similar but more flexible mechanism is the notion of <strong>condition variable</strong>.
Intuitively, it allows putting a thread to sleep, and waking it up when a certain condition is verified.</p>
<p>A variety of programming languages support condition variables.
These include C++, C#, Go, Java, Python or Rust.</p>
<h3 id="the-producerconsumer-pattern">
  The producer/consumer pattern
  <a class="anchor" href="#the-producerconsumer-pattern">#</a>
</h3>
<p>A prototypical application of condition variables is the so-called <strong>producer/consumer</strong> pattern.
In this scenario, two pools of threads (usually with fixed sizes) communicate via a <a href="">queue</a>.</p>
<ol>
<li>A pool of <strong>producer</strong> threads, which create elements and add them to the queue (a.k.a. <strong>enqueue</strong>),</li>
<li>A pool of <strong>consumer</strong> threads, which receive (a.k.a <strong>dequeue</strong>) these elements and process them.</li>
</ol>
<p>Two situations may occur where threads should be put to sleep:</p>
<ol>
<li>the queue is empty (e.g. because the process just started, or because elements have been consumed faster than they were produced): consumers should be put to sleep until an element is produced.</li>
<li>the queue is full (e.g. because elements have been produced faster than they were consumed): producers should be put to sleep until an element is consumed.</li>
</ol>
<h3 id="in-java-2">
  in Java
  <a class="anchor" href="#in-java-2">#</a>
</h3>
<blockquote class="book-hint warning">
  <p><strong><em>Reminder.</em></strong>
As discussed above, a thread can acquire the intrinsic lock of an object by either:</p>
<ul>
<li>executing a synchronized method for this object, or</li>
<li>entering a synchronized block that uses this object as lock.</li>
</ul>
</blockquote>

<h4 id="wait">
  <code>wait</code>
  <a class="anchor" href="#wait">#</a>
</h4>
<p>The instance method <code>Object.wait</code> can only be called by a thread that acquired the intrinsic lock of the object.
It has the effect of releasing this lock, and putting the thread to sleep, until another thread executes the method <code>notify</code> (or <code>notifyAll</code>) for this same object.</p>
<h4 id="notify">
  <code>notify</code>
  <a class="anchor" href="#notify">#</a>
</h4>
<p>Similarly to <code>Object.wait</code>, the instance method <code>Object.notify</code> can only be called by a thread that acquired the intrinsic lock of the object.
It has the effect of attempting to wake up <em>one</em> thread (if any) that is waiting for the lock of this object.
The awakened thread will only proceed (i.e. actually wake up) after the notifying thread releases the lock of the object.</p>
<h4 id="notifyall">
  <code>notifyAll</code>
  <a class="anchor" href="#notifyall">#</a>
</h4>
<p>The instance method <code>Object.notifyAll</code> is identical to <code>Object.notify</code>, but attempts to wake up <em>all</em> threads that are waiting for the lock of this object.</p>
<blockquote class="book-hint info">
  <p><strong><em>Example.</em></strong>
For simplicity, we will use a queue with a capacity of 1.
The example is borrowed from the <a href="https://docs.oracle.com/javase%2Ftutorial%2F/essential/concurrency/guardmeth.html">Oracle tutorials</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyQueue</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    T item;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">boolean</span> isEmpty <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> T <span style="color:#a6e22e">dequeue</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(isEmpty){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                wait();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (InterruptedException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        isEmpty <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        notifyAll();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> item;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When a (consumer) thread $c$ executes the method <code>dequeue</code>, it acquires the intrinsic lock of the queue (because the method is synchronized).
If the queue is empty, it releases the lock and waits for another (producer) thread to wake it up.
If this happens, thread $c$:</p>
<ul>
<li>indicates that the queue should now be considered empty,</li>
<li>wakes up a consumer thread (if any) waiting for the queue to be empty.</li>
</ul>
<p>The method enqueue is symmetric:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>pulic <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyQueue</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">enqueue</span>(T item){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#f92672">!</span>isEmpty){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                wait();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (InterruptedException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        isEmpty <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> item;
</span></span><span style="display:flex;"><span>        notifyAll();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>A naive consumer thread could be implemented as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Consumer</span>(MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">queue</span> <span style="color:#f92672">=</span> queue;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>){
</span></span><span style="display:flex;"><span>            consumeItem(queue.<span style="color:#a6e22e">dequeue</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">consumeItem</span>(Item item){
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And a naive producer could be implemented symmetrically:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Producer</span>(MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">queue</span> <span style="color:#f92672">=</span> queue;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>){
</span></span><span style="display:flex;"><span>            queue.<span style="color:#a6e22e">enqueue</span>(produceItem());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Item <span style="color:#a6e22e">produceItem</span>(){
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Finally, the main thread may spawn one producer an two consumers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyQueue<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    Thread p1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> Producer(queue));
</span></span><span style="display:flex;"><span>    Thread c1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> Consumer(queue));
</span></span><span style="display:flex;"><span>    Thread c2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> Consumer(queue));
</span></span><span style="display:flex;"><span>    p1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    c1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    c2.<span style="color:#a6e22e">start</span>();
</span></span></code></pre></div>
</blockquote>

<h3 id="spurious-wakeup">
  Spurious wakeup
  <a class="anchor" href="#spurious-wakeup">#</a>
</h3>
<p>In the example above, the loop <code>while(isEmpty)</code> (in the method <code>dequeue</code>) seems unnecessary, in the sense that it could be replaced with the conditional statements <code>if(isEmpty)</code>.
And similarly for the loop in the method <code>enqueue</code>.</p>
<p>The purpose of this loop is to handle the abnormal case where a consumer (resp. producer) is awaken while the condition variable <code>isEmpty</code> has value <code>true</code> (resp. <code>false</code>).
Such a situation is called a <a href="https://en.wikipedia.org/wiki/Spurious_wakeup">spurious wakeup</a>, and may have a variety of causes (including a <a href="">race condition</a>).</p>
<p>This is the reason why it is customary to write:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#f92672">&lt;</span>conditionVariable<span style="color:#f92672">&gt;</span>){
</span></span><span style="display:flex;"><span>    wait();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>rather than:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#f92672">&lt;</span>conditionVariable<span style="color:#f92672">&gt;</span>){
</span></span><span style="display:flex;"><span>    wait();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#precedence">Precedence</a>
      <ul>
        <li><a href="#in-java">in Java</a></li>
      </ul>
    </li>
    <li><a href="#mutual-exclusion">Mutual exclusion</a>
      <ul>
        <li><a href="#in-java-1">in Java</a></li>
      </ul>
    </li>
    <li><a href="#condition-variables">Condition variables</a>
      <ul>
        <li><a href="#the-producerconsumer-pattern">The producer/consumer pattern</a></li>
        <li><a href="#in-java-2">in Java</a></li>
        <li><a href="#spurious-wakeup">Spurious wakeup</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












